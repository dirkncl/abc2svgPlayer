// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2018 Jean-Francois Moine - LGPL3+
window.onerror=function(msg,url,line){if(typeof msg=="string")alert("window error: "+msg+"\nURL: "+url+"\nLine: "+line);else if(typeof msg=="object")alert("window error: "+msg.type+" "+msg.target.src);else alert("window error: "+msg);return false};var errtxt="",new_page="",abc,jsdir=document.currentScript?document.currentScript.src.match(/.*\//):function(){var scrs=document.getElementsByTagName("script");return scrs[scrs.length-1].src.match(/.*\//)||""}();var user={errmsg:function(msg,l,c){errtxt+=clean_txt(msg)+"\n"},img_out:function(str){new_page+=str},page_format:true};function clean_txt(txt){return txt.replace(/<|>|&.*?;|&/g,function(c){switch(c){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;"}return c})}function dom_loaded(){if(typeof abc2svg!="object"||!abc2svg.modules){setTimeout(dom_loaded,500);return}abc2svg.loadjs=function(fn,relay,onerror){var s=document.createElement("script");if(/:\/\//.test(fn))s.src=fn;else s.src=jsdir+fn;s.type="text/javascript";if(relay)s.onload=relay;s.onerror=onerror||function(){alert("error loading "+fn)};document.head.appendChild(s)};var page=document.body.innerHTML;if(!abc2svg.modules.load(page,dom_loaded))return;var i=0,j,k,res,re=/\n%abc|\nX:/g,re_stop=/\n<|\n%.begin/g;abc=new abc2svg.Abc(user);abc.tosvg("abcdoc","%%bgcolor white\n%%rightmargin 0.8cm\n%%leftmargin 0.8cm\n%%topspace 0");for(;;){res=re.exec(page);if(!res)break;j=re.lastIndex-res[0].length;new_page+=page.slice(i,j);re_stop.lastIndex=++j;while(1){res=re_stop.exec(page);if(!res||res[0]=="\n<")break;k=page.indexOf(res[0].replace("begin","end"),re_stop.lastIndex);if(k<0)break;re_stop.lastIndex=k}if(!res||k<0)k=page.length;else k=re_stop.lastIndex-2;tune=page.slice(j,k);new_page+='<pre style="display:inline-block; vertical-align: top">'+clean_txt(tune)+'</pre>\n<div style="display:inline-block; vertical-align: top">\n';try{abc.tosvg("abcdoc",tune)}catch(e){alert("abc2svg javascript error: "+e.message+"\nStack:\n"+e.stack)}if(errtxt){i=page.indexOf("\n",j);i=page.indexOf("\n",i+1);alert("Errors in\n"+page.slice(j,i)+"\n...\n\n"+errtxt);errtxt=""}new_page+="</div><br/>\n";i=k;if(k>=page.length)break;re.lastIndex=i}try{document.body.innerHTML=new_page+page.slice(i)}catch(e){alert("abc2svg bad generated SVG: "+e.message+"\nStack:\n"+e.stack)}}document.addEventListener("DOMContentLoaded",dom_loaded,false);
